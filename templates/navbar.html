<nav class="navbar">
    <div class="navbar-left">
        <!-- JS Vanilla detecta el click en la clase 'sidebar-toggle' -->
        <button class="sidebar-toggle" title="Colapsar menÃº">
            <i class="fa-solid fa-bars"></i>
        </button>
    </div>

    <div class="navbar-actions">
        <!-- 1. Notificaciones -->
        <div class="notification-wrapper" title="Notificaciones">
            <i class="fa-regular fa-bell fa-lg"></i>
            <span class="notification-badge">3</span>
        </div>

        <!-- 2. Usuario Dropdown -->
        <div class="user-dropdown-container">

            <!-- JS Vanilla detecta el click en la clase 'user-trigger' -->
            <div class="user-trigger">
                <div class="text-right hidden-mobile">
                    <small style="display:block; line-height:1; font-size: 0.75rem; color:#64748b;">Bienvenido,</small>
                    <span class="user-name">{{ request.user.username }}</span>
                </div>

                {% if request.user.avatar %}
                    <img src="{{ request.user.avatar.url }}" class="user-avatar">
                {% else %}
                    <div class="user-avatar">{{ request.user.username|make_list|first|upper }}</div>
                {% endif %}
                <i class="fa-solid fa-chevron-down" style="font-size: 0.7rem; color: #94a3b8;"></i>
            </div>

            <!-- IMPORTANTE: Agregada clase 'hidden' por defecto.
                 Quitamos v-if y @mouseleave que eran de Vue. -->
            <div class="dropdown-menu hidden">

                <a href="{% url 'core:profile' %}" class="dropdown-item">
                    <i class="fa-regular fa-user"></i> Ver Perfil
                </a>

                <div class="dropdown-divider"></div>

                <!-- Logout seguro con POST -->
                <form action="{% url 'core:logout' %}" method="post" id="logout-form">
                    {% csrf_token %}
                    <a href="#" class="dropdown-item"
                       onclick="document.getElementById('logout-form').submit(); return false;"
                       style="color: var(--error, #ef4444);">
                        <i class="fa-solid fa-right-from-bracket"></i> Cerrar SesiÃ³n
                    </a>
                </form>
            </div>
        </div>
    </div>
</nav>