{% load static %}
<div class="table-container">
    <input type="hidden" id="server-level-indicator" value="{{ current_display_level }}">
    <table>
        <thead>
        <tr>
            <!-- Corregí el encabezado, había un enlace vacío '#' -->
            <th><i class="fa-solid fa-list-ol"></i></th>
            <th>Empleado</th>
            <th><i class="far fa-envelope header-icon"></i> Email</th>
            <th><i class="fas fa-phone header-icon"></i> Teléfono</th>
            <th class="text-center"><i class="fas fa-building header-icon"></i> Dependencia</th>
            <th class="text-center"><i class="fas fa-toggle-on header-icon"></i> Estado</th>
            {% if perms.person.change_person or perms.person.delete_person %}
                <th class="text-center"><i class="fas fa-cogs header-icon"></i> Acciones</th>
            {% endif %}
        </tr>
        </thead>
        <tbody id="table-body">
        {% for person in people %}
            <!-- ID ÚNICO PARA LA FILA: row-ID -->
            <tr class="location-row" id="row-{{ person.id }}"
                data-status="{{ person.is_active|yesno:'true,false' }}">
                <td>{{ page_obj.start_index|add:forloop.counter0 }}</td>

                <td>
                    <div class="person-info">
                        {% if person.photo %}
                            <img src="{{ person.photo.url }}" alt="{{ person.first_name }}" class="person-avatar">
                        {% else %}
                            <div class="person-avatar-placeholder">
                                {{ person.first_name|first }}{{ person.last_name|first }}
                            </div>
                        {% endif %}
                        <div class="person-details">
                            <!-- Invertí el orden habitual: Nombre Apellido -->
                            <h4>{{ person.first_name }} {{ person.last_name }}</h4>
                            <p><i class="far fa-address-card"></i> {{ person.document_number|default:"S/N" }}</p>
                        </div>
                    </div>
                </td>
                <td>{{ person.email|default:"--" }}</td>
                <td>{{ person.phone_number|default:"--" }}</td>
                <td class="text-center">
                    {% if person.employee_profile.area %}
                        <div class="font-weight-700 small text-primary">
                            {{ person.employee_profile.area.name }}
                        </div>
                        {% if person.employee_profile.is_boss %}
                            <span class="status-badge" style="background: #fef3c7; color: #92400e; font-size: 0.6rem;">JEFE/A</span>
                        {% endif %}
                    {% else %}
                        <span class="text-muted small italic">Sin unidad asignada</span>
                    {% endif %}
                </td>
                <td class="text-center">
                    {% with emp=person.employee_profile %}
                        {% if emp.employment_status %}
                            <span class="status-badge
                                {% if emp.employment_status.code == 'PERSONA' %}neutral
                                {% elif emp.employment_status.code == 'EMPLEADO' or emp.employment_status.code == 'TRABAJADOR' %}active
                                {% elif 'EX_' in emp.employment_status.code %}inactive
                                {% else %}general{% endif %}">
                                {{ emp.employment_status.name }}
                            </span>
                        {% else %}
                            <span class="status-badge neutral">PERSONA</span>
                        {% endif %}
                    {% endwith %}
                </td>

                {% if perms.person.change_person or perms.person.delete_person %}
                    <td>
                        <div class="actions-wrapper">

                            <button type="button"
                                    class="btn-views-action btn-quick-view"
                                    data-id="{{ person.id }}"
                                    title="Vista Rápida">
                                <i class="fa-solid fa-eye"></i>
                            </button>

                            <a href="{% url 'employee:employee_detail' person.id %}"
                               class="btn-list-action"
                               title="Ver Detalle Completo">
                                <i class="fa-solid fa-user-gear"></i>
                            </a>
                        </div>
                    </td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="no-results-overlay {% if people %}hidden{% endif %}">
        <div class="no-results-content empty-db-msg {% if not people %}show{% else %}hidden{% endif %}">
            <i class="fas fa-inbox no-results-icon"></i>
            <p class="no-results-text">No hay personas registradas.</p>
        </div>

        <!-- Mensaje Búsqueda (lo maneja JS al filtrar) -->
        <div class="no-results-content hidden" id="no-results-placeholder">
            <i class="fas fa-search no-results-icon"></i>
            <p class="no-results-text">No se encontraron resultados.</p>
        </div>
    </div>
</div>