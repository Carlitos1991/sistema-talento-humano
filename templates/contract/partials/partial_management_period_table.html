{% load static %}
<div class="table-container">
    <table>
        <thead>
        <tr>
            <th><i class="fas fa-user-tie header-icon"></i> Empleado / Documento</th>
            <th><i class="fas fa-briefcase header-icon"></i> Cargo y Partida</th>
            <th><i class="fas fa-sitemap header-icon"></i> Dependencia</th>
            <th><i class="fas fa-file-contract header-icon"></i> Tipo de Contrato</th>
            <th><i class="fas fa-calendar-alt header-icon"></i> Vigencia</th>
            <th><i class="fas fa-toggle-on header-icon"></i> Estado</th>
            <th class="actions"><i class="fas fa-cogs header-icon"></i> Acciones</th>
        </tr>
        </thead>
        <tbody id="management-table-body">
        {% for period in periods %}
            <tr class="period-row">
                <td>
                    <div class="person-info">
                        {% if period.employee.person.photo %}
                            <img src="{{ period.employee.person.photo.url }}" class="person-avatar" alt="Foto">
                        {% else %}
                            <div class="person-avatar-placeholder">
                                {{ period.employee.person.first_name|first }}{{ period.employee.person.last_name|first }}
                            </div>
                        {% endif %}
                        <div class="person-details">
                            <h4>{{ period.employee.person.full_name }}</h4>
                            <p><i class="fas fa-id-card mr-1"></i> {{ period.employee.person.document_number }}</p>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="font-weight-700 text-primary">{{ period.budget_line.position_item.name }}</div>
                    <small class="text-muted">Partida: {{ period.budget_line.number_individual|default:period.budget_line.code }}</small>
                </td>
                <td><span class="small font-weight-600">{{ period.administrative_unit.name }}</span></td>
                <td>
                    <span class="status-badge general">{{ period.contract_type.name }}</span><br>
                    <small class="text-muted italic">{{ period.contract_type.labor_regime.name }}</small>
                </td>
                <td>
                    <div class="vigencia-box">
                        <span><strong>Inicio:</strong> {{ period.start_date|date:"d/m/Y" }}</span>
                        <span><strong>Fin:</strong> {% if period.end_date %}{{ period.end_date|date:"d/m/Y" }}{% else %}
                            Indefinido{% endif %}</span>
                    </div>
                </td>
                <td>
                        <span class="status-badge {% if period.status.code == 'SIN_FIRMAR' %}sin-firmar{% elif period.status.code == 'FIRMADO' %}firmado{% else %}general{% endif %}">
                            {{ period.status.name }}
                        </span>
                </td>
                <td class="actions">
                    <div class="actions-wrapper">
                        {% if period.status.code == 'SIN_FIRMAR' %}
                            <button class="btn-create-action" data-id="{{ period.id }}" data-action="sign"
                                    title="Legalizar">
                                <i class="fas fa-file-signature"></i>
                            </button>
                        {% endif %}
                        <button class="btn-list-action" data-id="{{ period.id }}" data-action="view" title="Expediente">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-delete-action" data-id="{{ period.id }}" data-action="terminate"
                                title="Finalizar">
                            <i class="fas fa-user-slash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        {% empty %}
            <tr class="server-empty-state">
                <td colspan="7">
                    <div class="empty-state-container">
                        <i class="fas fa-database empty-state-icon"></i>
                        <p class="empty-state-text">No se encontraron registros en la Base de Datos.</p>
                    </div>
                </td>
            </tr>
        {% endfor %}

        <!-- FILA DE ESTADO VACÍO (MANEJADA POR JS) -->
        <tr id="frontend-no-results" class="hidden">
            <td colspan="7">
                <div class="empty-state-container">
                    <i class="fas fa-search-minus empty-state-icon"></i>
                    <p class="empty-state-text">No existen registros con el filtro aplicado en esta lista.</p>
                    <button class="btn-search btn-secondary-search mt-2" data-action="advanced-search-empty">
                        <i class="fas fa-database"></i> Intentar Búsqueda en toda la BD
                    </button>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>