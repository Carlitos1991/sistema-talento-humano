<!-- templates/function_manual/modals/modal_valuation_node_form.html -->
<div class="valuation-modal-wrapper" :class="{ 'is-active': showModal }" v-if="showModal">
    <!-- Overlay oscuro separado -->
    <div class="valuation-modal-backdrop" @click="closeModal"></div>
    
    <!-- Contenedor del modal (FUERA del backdrop para evitar blur) -->
    <div class="valuation-modal-box">
        <div class="modal-header modal-header-gradient">
            <h3 class="modal-title text-white">
                <i class="fa-solid fa-layer-group me-2"></i>
                [[ isEdit ? 'Editar ' : 'Nuevo ' ]] [[ currentNodeTypeName ]]
            </h3>
            <button type="button" class="btn-close-modal text-white-opacity" @click="closeModal">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form @submit.prevent="saveNode">
            <div class="modal-body modal-body-custom">
                <!-- Select de Catálogos -->
                <div class="form-group"
                     v-if="['ROLE', 'INSTRUCTION', 'DECISION', 'IMPACT', 'COMPLEXITY'].includes(workingType)">
                    <label class="form-label">
                        <i class="fa-solid fa-list-ul"></i> Seleccionar Item de Catálogo (*)
                    </label>
                    <select v-model="formData.catalog_item_id" class="input-field" required>
                        <option value="">Seleccione una opción...</option>
                        <option v-for="item in filteredCatalogItems" :key="item.id" :value="item.id">
                            [[ item.name ]]
                        </option>
                    </select>
                </div>

                <!-- Input de Texto (Experiencia) -->
                <div class="form-group" v-if="workingType === 'EXPERIENCE'">
                    <label class="form-label">
                        <i class="fa-solid fa-clock"></i> Descripción de Experiencia (*)
                    </label>
                    <input type="text" v-model="formData.name_extra" class="input-field"
                           placeholder="Ej: Mínimo 24 meses" required>
                </div>

                <!-- Select de Matriz (Resultado) -->
                <div class="form-group" v-if="workingType === 'RESULT'">
                    <label class="form-label">
                        <i class="fa-solid fa-bullseye"></i> Vincular Clasificación Ocupacional (*)
                    </label>
                    <select v-model="formData.occupational_classification_id" class="input-field" required>
                        <option value="">Seleccione clasificación...</option>
                        <option v-for="m in catalogs.matrix" :key="m.id" :value="m.id">
                            [[ m.occupational_group ]] ($[[ m.remuneration ]])
                        </option>
                    </select>
                </div>
            </div>

            <div class="modal-footer modal-footer-spaced">
                <button type="button" class="btn-cancel" @click="closeModal">
                    Cancelar
                </button>
                <button type="submit" class="btn-save" :disabled="loading">
                    <i v-if="loading" class="fa-solid fa-spinner fa-spin"></i>
                    <i v-else class="fas fa-save"></i>
                    [[ loading ? 'Guardando...' : 'Guardar' ]]
                </button>
            </div>
        </form>
    </div>
</div>