<div id="manual-item-form-app" v-cloak>
    <div class="modal-overlay" :class="{ 'hidden': !isVisible }"
         id="item-modal-overlay" role="dialog" aria-modal="true">
        <form @submit.prevent="submitItem" id="form-create-item">
            {% csrf_token %}

            <div class="modal-container animate-scale-in" id="item-modal" tabindex="-1" role="document">

                <!-- HEADER CORREGIDO -->
                <div class="modal-header modal-header-gradient">
                    <h3 class="modal-title text-white" id="item-modal-title">
                        <i class="fa-solid fa-tag me-2"></i> [[ modalTitle ]]
                    </h3>
                    <button type="button" class="btn-close-modal text-white-opacity" @click="closeModal">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </button>
                </div>

                <!-- BODY con estilo gris suave -->
                <div class="modal-body modal-body-custom">

                    <!-- Primera fila: Nombre y Código -->
                    <div class="form-row-2-cols">
                        <!-- CAMPO NOMBRE -->
                        <div class="form-group">
                            <label for="{{ item_form.name.id_for_label }}" class="form-label">
                                <i class="fa-solid fa-folder-closed"></i> {{ item_form.name.label }}(*)
                            </label>
                            <input class="input-field uppercase-input" id="id_name" name="name" type="text"
                                   v-model="form.name" placeholder="Ej: LIDERAZGO" required/>
                            <div class="error-message-container" v-if="errors.name">
                                <span class="text-danger small" v-for="(error, index) in errors.name" :key="index">
                                    <i class="fas fa-exclamation-circle"></i> [[ error ]]
                                </span>
                            </div>
                            <p class="form-hint">Nombre descriptivo del ítem.</p>
                        </div>

                        <!-- CAMPO CÓDIGO -->
                        <div class="form-group">
                            <label for="{{ item_form.code.id_for_label }}" class="form-label">
                                <i class="fa-solid fa-barcode"></i> {{ item_form.code.label }}(*)
                            </label>
                            <input class="input-field uppercase-input"
                                   id="id_code" name="code" type="text"
                                   v-model="form.code"
                                   :readonly="isEditing"
                                   :style="isEditing ? 'background-color: #e9ecef; cursor: not-allowed;' : ''"
                                   placeholder="Ej: LID" required/>
                            <div class="error-message-container" v-if="errors.code">
                                <span class="text-danger small" v-for="(error, index) in errors.code" :key="index">
                                    <i class="fas fa-exclamation-circle"></i> [[ error ]]
                                </span>
                            </div>
                            <p class="form-hint">Código único.</p>
                        </div>
                    </div>

                    <!-- CAMPO DESCRIPCIÓN - Ancho completo -->
                    <div class="form-group">
                        <label for="{{ item_form.description.id_for_label }}" class="form-label">
                            <i class="fa-solid fa-align-left"></i> {{ item_form.description.label }}
                        </label>
                        <textarea class="input-field" id="id_description" name="description" rows="3"
                                  v-model="form.description" placeholder="Descripción del ítem (opcional)"></textarea>
                        <div class="error-message-container" v-if="errors.description">
                            <span class="text-danger small" v-for="(error, index) in errors.description" :key="index">
                                <i class="fas fa-exclamation-circle"></i> [[ error ]]
                            </span>
                        </div>
                        <p class="form-hint">Información adicional sobre el ítem.</p>
                    </div>

                    <div class="form-group mt-3">
                        <label class="form-label">
                            <i class="fa-solid fa-users-gear"></i> Roles Permitidos (Solo para Verbos)
                        </label>
                        
                        <!-- Si es un catálogo de Verbos, mostramos el combo múltiple. Caso contrario, el input legacy -->
                        <div v-if="isVerbCatalog">
                            {{ item_form.roles }}
                        </div>
                        <div v-else>
                            <input class="input-field" type="text" v-model="form.target_groups"
                                   placeholder="Ej: SP1,SP2,SP3 o TODOS"/>
                             <p class="form-hint">Escriba los códigos separados por coma. Use "TODOS" para que aparezca
                            siempre.</p>
                        </div>
                   
                        <!-- Campo oculto real que se vincula al modelo -->
                        <input type="hidden" name="target_groups" :value="form.target_groups">
                    </div>
                </div>

                <!-- FOOTER centrado y espaciado -->
                <div class="modal-footer modal-footer-spaced">
                    <button type="button" class="btn-cancel" @click="closeModal">
                        Cancelar
                    </button>
                    <button type="submit" class="btn-save"><i class="fas fa-save"></i> Guardar</button>
                </div>
            </div>
        </form>
    </div>
</div>
