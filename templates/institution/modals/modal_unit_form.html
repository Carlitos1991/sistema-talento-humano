<!-- En modal_unit_form.html -->

<div id="unit-modal-app" v-cloak>
    <div class="modal-overlay" :class="{ 'hidden': !isVisible }" role="dialog">
        <div class="modal-container-medium animate-scale-in" style="max-width: 800px;">
            <form @submit.prevent="submitForm" id="unitForm">
                {% csrf_token %}

                <div class="modal-header-medium modal-header-gradient">
                    <h3 class="modal-title text-white">
                        <i class="fa-solid fa-sitemap me-2"></i>
                        <span v-text="isEditing ? 'Editar Unidad Administrativa' : 'Nueva Unidad Administrativa'"></span>
                    </h3>
                    <button type="button" class="btn-close-modal text-white-opacity" @click="closeModal">&times;
                    </button>
                </div>

                <div class="modal-body-content modal-body-custom">
                    <!-- Errores Generales -->
                    <div v-if="errors.__all__" class="alert alert-danger mb-3">
                        <span v-for="err in errors.__all__">[[ err ]]</span>
                    </div>

                    <!-- Datos Principales -->
                    <div class="form-section-card">
                        <h6 class="section-title"><i class="fa-solid fa-circle-info me-2"></i>Información General</h6>

                        <div class="row mb-3">
                            <div class="col-12 form-group">
                                <label class="form-label">Nombre de la Unidad <span class="text-danger">*</span></label>
                                {{ form.name }}
                                <div class="text-error" v-if="errors.name">[[ errors.name[0] ]]</div>
                            </div>
                        </div>

                        <div class="grid-2-cols">
                            <div class="form-group">
                                <label class="form-label">Nivel Jerárquico <span class="text-danger">*</span></label>
                                {{ form.level }}
                                <div class="text-error" v-if="errors.level">[[ errors.level[0] ]]</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unidad Padre (Dependencia)</label>
                                <div :class="{ 'opacity-50': isParentDisabled }">
                                    {{ form.parent }}
                                </div>
                                <div class="text-error" v-if="errors.parent">[[ errors.parent[0] ]]</div>
                                <small class="form-hint" v-if="isParentDisabled">
                                    Deshabilitado para el Nivel 1 o si no se ha seleccionado nivel.
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Datos Administrativos -->
                    <div class="form-section-card">
                        <h6 class="section-title"><i class="fa-solid fa-briefcase me-2"></i>Gestión y Contacto</h6>

                        <div class="form-group mb-3">
                            <label class="form-label">Jefe / Responsable</label>
                            <!-- Django renderiza el select, Vue/JS lo maneja con Select2 -->
                            {{ form.boss }}
                            <div class="text-error" v-if="errors.boss">[[ errors.boss[0] ]]</div>
                            <small class="form-hint">Seleccione un empleado activo para asignar jefatura.</small>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-4 form-group">
                                <label class="form-label">Código / Partida</label>
                                {{ form.code }}
                            </div>
                            <div class="col-md-4 form-group">
                                <label class="form-label">Ubicación Física</label>
                                {{ form.address }}
                            </div>
                            <div class="col-md-4 form-group">
                                <label class="form-label">Teléfono / Ext.</label>
                                {{ form.phone }}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer-medium modal-footer-spaced">
                    <button type="button" class="btn-cancel" @click="closeModal">Cancelar</button>
                    <button type="submit" class="btn-save shadow-md">
                        <i class="fa-solid fa-save me-2"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>