<!-- templates/budget/modals/modal_budget_assign_employee.html -->
<div class="modal-overlay">
    <div class="modal-container-medium" style="width: 750px; margin: auto;">
        <div class="modal-header-medium modal-header-gradient"
             style="background: linear-gradient(to right, #2563eb, #3b82f6);">
            <h3 class="modal-title text-white">
                <i class="fa-solid fa-user-plus me-2"></i> Asignar Persona a Partida
            </h3>
            <button type="button" class="btn-close-modal text-white-opacity" onclick="closeBudgetModal()">&times;
            </button>
        </div>

        <form id="assignEmployeeForm" method="POST" onsubmit="submitAssignEmployee(event, {{ line.pk }})">
            {% csrf_token %}
            <div class="modal-body-content modal-body-custom">
                <!-- Info de Partida (Resumen) -->
                <div class="form-section-card" style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                    <div class="row small">
                        <div class="col-md-6"><strong>Código:</strong> {{ line.code }}</div>
                        <div class="col-md-6"><strong># Individual:</strong> {{ line.number_individual }}</div>
                        <div class="col-md-6"><strong>Cargo:</strong> {{ line.position_item.name }}</div>
                        <div class="col-md-6"><strong>RMU:</strong> ${{ line.remuneration }}</div>
                    </div>
                </div>

                <!-- Buscador -->
                <div class="form-group mt-3">
                    <label class="form-label font-weight-bold">Cédula de la Persona *</label>
                    <div class="d-flex gap-2">
                        <input type="text" id="search-cedula" class="input-field"
                               placeholder="Ingrese cédula (10 dígitos)" maxlength="10">
                        <button type="button" class="btn btn-search" onclick="searchEmployee()">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                </div>

                <!-- RESULTADO DE BÚSQUEDA (El JS le quita la clase 'hidden') -->
                <div id="search-result-card" class="hidden mt-3">
                    <div class="form-section-card" style="border-left: 5px solid #10b981; background: #f0fdf4;">
                        <div class="person-info">
                            <!-- CONTENEDOR PARA LA FOTO O INICIALES -->
                            <div id="res-photo" class="person-avatar-container">
                                <!-- Se llena vía JS -->
                            </div>
                            <div class="person-details">
                                <h4 id="res-name" class="mb-0 text-success" style="font-weight: 700;"></h4>
                                <p id="res-email" class="text-muted small mb-0"></p>
                            </div>
                        </div>
                        <input type="hidden" name="employee_id" id="selected-employee-id">
                    </div>
                </div>

                <div class="form-group mt-3">
                    <label class="form-label">Observaciones</label>
                    <textarea name="observation" class="input-field" rows="2"
                              placeholder="Motivo de la asignación..."></textarea>
                </div>

                <div class="alert-info mt-3" style="font-size: 0.85rem;">
                    <i class="fas fa-info-circle me-1"></i> Al asignar, el estado cambiará automáticamente a <strong>OCUPADA</strong>.
                </div>
            </div>

            <div class="modal-footer-medium modal-footer-spaced">
                <button type="button" class="btn-cancel" onclick="closeBudgetModal()">Cancelar</button>
                <button type="submit" id="btn-submit-assign" class="btn-save" disabled style="background: #1e40af;">
                    <i class="fas fa-user-check me-2"></i> Asignar Persona
                </button>
            </div>
        </form>
    </div>
</div>