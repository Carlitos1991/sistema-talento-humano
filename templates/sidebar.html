{% load static %}
<aside class="sidebar" id="mainSidebar">
    <script>
        if (localStorage.getItem('sidebar_collapsed') === 'true') {
            document.getElementById('mainSidebar').classList.add('collapsed');
        }
    </script>
    <div class="sidebar-header">
        <img src="{% static 'img/logo.png' %}" alt="Logo" class="sidebar-logo-img">
        <span class="sidebar-brand-text">SIGETH</span>
    </div>

    <ul class="sidebar-menu">
        <li>
            <a href="{% url 'core:dashboard' %}"
               class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                <i class="fa-solid fa-home"></i>
                <span class="menu-text">Inicio</span>
            </a>
        </li>
        {% if perms.person.view_person %}
            <li>
                <a href="{% url 'person:person_list' %}"
                   class="{% if 'person' in request.resolver_match.app_name %}active{% endif %}">
                    <i class="fa-solid fa-users"></i>
                    <span class="menu-text">Personas</span>
                </a>
            </li>
        {% endif %}

        <!-- MENÚ PADRE: Ajustes -->
        <!-- Quitamos :class y @click. El JS detecta la clase 'has-submenu' -->
        {% if perms.core.view_user or perms.auth.view_group or perms.core.view_catalog or perms.core.view_location %}
            <li class="has-submenu">
                <a href="#">
                    <i class="fa-solid fa-gear"></i>
                    <span class="menu-text">Ajustes</span>
                    <i class="fa-solid fa-chevron-right chevron-icon"></i>
                </a>
                <ul class="submenu">
                    <li class="submenu-title">Ajustes</li>
                    {% if perms.core.view_user %}
                        <li>
                            <a href="{% url 'security:user_list' %}">
                                <i class="fa-solid fa-user-shield"></i>
                                <span class="menu-text">Usuarios Sistema</span>
                            </a>
                        </li>
                    {% endif %}
                    {% if perms.auth.view_group %}
                        <li>
                            <a href="{% url 'security:role_list' %}">
                                <i class="fa-solid fa-user-lock"></i>
                                <span class="menu-text">Roles y Permisos</span>
                            </a>
                        </li>
                    {% endif %}
                    {% if perms.core.view_catalog %}
                        <li>
                            <a href="{% url 'core:catalog_list' %}">
                                <i class="fa-solid fa-list-check"></i>
                                <span class="menu-text">Catálogos</span>
                            </a>
                        </li>
                    {% endif %}
                    {% if perms.core.view_location %}
                        <li>
                            <a href="{% url 'core:location_list' %}">
                                <i class="fa-solid fa-map-location"></i>
                                <span class="menu-text">Ubicaciones</span>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </li>
        {% endif %}
    </ul>
</aside>